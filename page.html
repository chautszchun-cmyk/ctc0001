<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¡é€šé›»è·¯å°é›»é«”ç·´ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap'); /* å¯æ„›å¡é€šå­—é«” */
        body { font-family: 'Fredoka', sans-serif; }

        /* æ¨™é¡Œå‹•ç•« */
        @keyframes bounce-slow {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-slow {
            animation: bounce-slow 2s infinite ease-in-out;
        }

        /* é›»æµæµå‹•å‹•ç•« */
        @keyframes flow {
            from { stroke-dashoffset: 0; }
            to { stroke-dashoffset: -200; }
        }
        .electric-flow {
            stroke-dasharray: 10 5;
            animation: flow 2s linear infinite;
        }
        
        /* ç‡ˆæ³¡å¡é€šé¢¨æ ¼ */
        .bulb-off-cartoon {
            fill: #E5E7EB; 
            filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.2));
            transition: all 0.3s ease-in-out;
        }
        .bulb-on-cartoon {
            fill: #FFEB3B; 
            filter: drop-shadow(0 0 10px rgba(255, 235, 59, 0.8)) drop-shadow(0 0 20px rgba(255, 235, 59, 0.6));
            transition: all 0.3s ease-in-out;
        }

        /* é–‹é—œå’Œå…ƒä»¶æ‹–æ›³æ¨£å¼ */
        .switch-button-cartoon, .draggable-item {
            cursor: pointer;
            transition: transform 0.1s ease, filter 0.1s ease;
            filter: drop-shadow(0 0 3px rgba(0, 0, 0, 0.2));
            /* ç¢ºä¿ G å…ƒç´ å¯ä»¥æ¥æ”¶äº‹ä»¶ */
            pointer-events: bounding-box; 
        }
        .switch-button-cartoon:hover, .draggable-item:hover {
            transform: scale(1.05);
            filter: drop-shadow(0 0 5px rgba(0, 0, 0, 0.3));
        }
        .dragging {
            cursor: grabbing;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5));
            opacity: 0.9;
            transform: scale(1.1);
        }

        /* é›»ç·šå¡é€šé¢¨æ ¼ */
        .circuit-wire {
            stroke: #4B5563; 
            stroke-width: 10; 
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.2)); 
        }
        .current-wire {
            stroke: #3B82F6; 
            stroke-width: 10;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.5));
        }
        
        /* æ¸¬è©¦å€é€£æ¥é»æ¨£å¼ */
        .test-point {
            fill: #6EE7B7; /* æ·ºç¶ è‰² */
            stroke: #059669;
            stroke-width: 3;
            filter: drop-shadow(0 0 5px rgba(110, 231, 183, 0.7));
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-300 to-purple-400 min-h-screen flex items-center justify-center p-4">

    <!-- Firebase æ¨¡æ“¬è®Šæ•¸ (æ¯å€‹æ‡‰ç”¨ç¨‹å¼å¿…é ˆåŒ…å«) -->
    <script>
        const __app_id = 'circuit-game-conductor-app';
        const __firebase_config = '{}';
        const __initial_auth_token = undefined;
    </script>
    
    <div class="w-full max-w-5xl bg-white shadow-2xl rounded-3xl p-8 border-4 border-yellow-400 transform rotate-3 scale-95 transition-transform duration-300 hover:rotate-0 hover:scale-100">
        <h1 class="text-4xl font-bold text-center text-indigo-700 mb-4 animate-bounce-slow">
            âš¡ å°é›»é«”èˆ‡çµ•ç·£é«”æ¸¬é©— ğŸ§ª
        </h1>
        <p class="text-center text-gray-700 text-lg mb-8">
            å°‡æ¸¬è©¦ç‰©å“æ‹–æ›³åˆ°é›»è·¯ç¼ºå£ï¼Œç„¶å¾Œé»æ“Šé–‹é—œï¼Œçœ‹çœ‹ç‡ˆæ³¡æœƒä¸æœƒäº®ï¼
        </p>

        <!-- SVG é›»è·¯åœ–å€åŸŸ -->
        <div id="circuit-container" class="flex justify-center items-center h-[550px] w-full p-4 bg-gray-100 rounded-2xl border-4 border-dashed border-gray-300 relative overflow-hidden">
            <!-- èƒŒæ™¯è£é£¾ -->
            <div class="absolute inset-0 z-0 opacity-20">
                <svg width="100%" height="100%">
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 L 0 40" fill="none" stroke="lightgray" stroke-width="1"/>
                    </pattern>
                    <rect width="100%" height="100%" fill="url(#grid)" />
                </svg>
            </div>

            <svg id="circuit-svg" viewBox="0 0 800 500" class="w-full h-full z-10">
                
                <!-- æ¸¬è©¦å€çš„è¦–è¦ºæ¨™è¨˜ (è™›ç·šæ–¹æ¡†) -->
                <rect x="450" y="300" width="100" height="100" fill="none" stroke="#60A5FA" stroke-dasharray="5 5" stroke-width="3" rx="10" ry="10"/>
                <text x="500" y="315" text-anchor="middle" font-size="16" fill="#60A5FA">æ¸¬è©¦å€</text>
                
                <!-- 1. é›»è·¯åŸºç¤è·¯å¾‘ (åˆ†ç‚ºå…©æ®µï¼Œä¸­é–“æœ‰ç¼ºå£) -->
                <path id="base-circuit-path-1" 
                      d="M 100 250 H 300 V 150 H 700 V 350 H 550" 
                      fill="none" 
                      class="circuit-wire"/>
                <path id="base-circuit-path-2" 
                      d="M 450 350 H 100 Z" 
                      fill="none" 
                      class="circuit-wire"/>
                
                <!-- 2. å‹•æ…‹é›»æµè·¯å¾‘ (åˆ†ç‚ºä¸‰æ®µï¼šSwitchå‰ã€Switchåˆ°Gapå‰ã€Gapåˆ°Battery) -->
                <path id="current-path-main-1" 
                      d="M 100 250 H 300 V 150 H 700 V 350 H 550" 
                      fill="none" 
                      class="current-wire hidden"/>
                <path id="current-path-main-2" 
                      d="M 450 350 H 100 Z" 
                      fill="none" 
                      class="current-wire hidden"/>

                <!-- 3. æ¸¬è©¦å€é›»è·¯é–‰åˆè·¯å¾‘ (ç•¶å°é›»é«”æ”¾ç½®æ™‚é€£æ¥ X=550 åˆ° X=450) -->
                <line id="test-gap-connector" x1="550" y1="350" x2="450" y2="350" stroke="#3B82F6" stroke-width="10" stroke-linecap="round" class="hidden"/>
                
                <!-- æ¸¬è©¦å€é€£æ¥é» -->
                <circle cx="550" cy="350" r="8" class="test-point"/>
                <circle cx="450" cy="350" r="8" class="test-point"/>
                
                <!-- ============== è£ç½®å…ƒä»¶ (èˆ‡ä¸Šç‰ˆç›¸åŒ) ============== -->
                
                <!-- é›»æ±  -->
                <g id="battery" transform="translate(150, 220)">
                    <rect x="0" y="0" width="80" height="60" rx="10" ry="10" class="battery-body" />
                    <rect x="80" y="10" width="15" height="40" rx="5" ry="5" class="battery-cap-positive"/>
                    <text x="88" y="38" class="text-3xl font-bold fill-white pointer-events-none">+</text>
                    <rect x="-15" y="10" width="15" height="40" rx="5" ry="5" class="battery-cap-negative"/>
                    <text x="-10" y="38" class="text-3xl font-bold fill-white pointer-events-none">-</text>
                    <text x="35" y="85" class="text-xl font-bold fill-gray-800 text-center pointer-events-none">é›»æ± </text>
                </g>
                
                <!-- ç‡ˆæ³¡ -->
                <g id="light-bulb" transform="translate(630, 120)" class="bulb-off-cartoon">
                    <circle cx="40" cy="40" r="35" fill="#F3F4F6" stroke="#9CA3AF" stroke-width="4"/>
                    <path d="M 25 25 L 55 55 M 25 55 L 55 25" stroke="#6B7280" stroke-width="4" stroke-linecap="round"/>
                    <rect x="30" y="70" width="20" height="15" fill="#9CA3AF" rx="5"/>
                    <text x="25" y="110" class="text-xl font-bold fill-gray-800 text-center pointer-events-none">ç‡ˆæ³¡</text>
                </g>
                
                <!-- é–‹é—œ -->
                <g id="switch" transform="translate(400, 150)">
                    <circle cx="0" cy="0" r="12" fill="#FBBF24" stroke="#D97706" stroke-width="3"/>
                    <circle cx="100" cy="0" r="12" fill="#FBBF24" stroke="#D97706" stroke-width="3"/>
                    
                    <line id="switch-arm-open" x1="0" y1="0" x2="60" y2="-60" stroke="#EF4444" stroke-width="8" stroke-linecap="round" class="switch-button-cartoon"/>
                    
                    <line id="switch-arm-closed" x1="0" y1="0" x2="100" y2="0" stroke="#10B981" stroke-width="8" stroke-linecap="round" class="switch-button-cartoon hidden"/>

                    <text x="35" y="70" class="text-xl font-bold fill-gray-800 text-center pointer-events-none">é–‹é—œ</text>
                </g>
                
                <!-- 4. æ¸¬è©¦å…ƒä»¶ (æ”¾ç½®åœ¨ç•«å¸ƒå¤–ï¼Œç­‰å€™æ‹–æ›³) -->
                <!-- å°é›»é«”ï¼šé‡‘å±¬èºçµ²/é‘°åŒ™ (Conductor) -->
                <g id="conductor-item" transform="translate(50, 400)" data-type="conductor" class="draggable-item">
                    <rect x="0" y="0" width="100" height="40" fill="#9CA3AF" rx="5" ry="5"/>
                    <rect x="5" y="5" width="90" height="30" fill="#E5E7EB" rx="3" ry="3"/>
                    <circle cx="50" cy="20" r="5" fill="#4B5563"/>
                    <text x="50" y="70" text-anchor="middle" class="text-xl font-bold fill-gray-800 pointer-events-none">å°é›»é«” (é‡‘å±¬)</text>
                </g>

                <!-- çµ•ç·£é«”ï¼šæœ¨æ£/æ©¡è†  (Insulator) -->
                <g id="insulator-item" transform="translate(200, 400)" data-type="insulator" class="draggable-item">
                    <rect x="0" y="0" width="100" height="40" fill="#964B00" rx="5" ry="5"/>
                    <rect x="5" y="5" width="90" height="30" fill="#A0522D" rx="3" ry="3"/>
                    <text x="50" y="70" text-anchor="middle" class="text-xl font-bold fill-gray-800 pointer-events-none">çµ•ç·£é«” (æœ¨æ)</text>
                </g>

            </svg>
        </div>

        <div class="mt-8 text-center bg-blue-100 p-4 rounded-xl shadow-inner border-2 border-blue-200">
            <p id="status-message" class="text-2xl font-bold text-red-600 animate-pulse">
                é›»è·¯ç‹€æ…‹ï¼šæ–·é–‹ (è«‹å…ˆæ‹–æ›³å…ƒä»¶ä¸¦é–‰åˆé–‹é—œ)
            </p>
            <p class="text-gray-600 mt-2">
                **ç›®æ¨™ï¼š** è§€å¯Ÿç•¶é›»è·¯ä¸­æ”¾å…¥ä¸åŒææ–™æ™‚ï¼Œé›»æµæ˜¯å¦èƒ½é€šéã€‚
            </p>
        </div>
    </div>

    <script>
        // DOM å…ƒç´ 
        const switchArmOpen = document.getElementById('switch-arm-open');
        const switchArmClosed = document.getElementById('switch-arm-closed');
        const lightBulb = document.getElementById('light-bulb');
        const statusMessage = document.getElementById('status-message');
        const currentPath1 = document.getElementById('current-path-main-1');
        const currentPath2 = document.getElementById('current-path-main-2');
        const testGapConnector = document.getElementById('test-gap-connector');
        
        // æ‹–æ›³å…ƒä»¶
        const conductorItem = document.getElementById('conductor-item');
        const insulatorItem = document.getElementById('insulator-item');
        const svg = document.getElementById('circuit-svg');

        // é›»è·¯é‚è¼¯ç‹€æ…‹
        let isSwitchClosed = false;
        let itemInGap = null; // 'conductor', 'insulator', or null
        
        // æ‹–æ›³ç‹€æ…‹
        let isDragging = false;
        let activeDragElement = null;
        let offset = { x: 0, y: 0 };
        // æ¸¬è©¦å€ç›®æ¨™ä¸­å¿ƒé»ï¼šX=500, Y=350 (å…ƒä»¶å¯¬åº¦ 100, é«˜åº¦ 40)
        const gapTarget = { x: 500, y: 350, width: 100, height: 100 }; 
        const gapTolerance = 50; 

        // ------------------ è¼”åŠ©å‡½æ•¸ ------------------

        /**
         * æå–äº‹ä»¶çš„å®¢æˆ¶ç«¯åº§æ¨™ï¼Œå…¼å®¹æ»‘é¼ å’Œè§¸æ§
         * @param {Event} e
         * @returns {{clientX: number, clientY: number}}
         */
        function getEventClientCoords(e) {
            // ä½¿ç”¨ touch äº‹ä»¶çš„ç¬¬ä¸€å€‹è§¸æ§é»ï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨ mouse äº‹ä»¶
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { clientX, clientY };
        }


        /**
         * å°‡è¢å¹•åº§æ¨™è½‰æ›ç‚º SVG åº§æ¨™
         * @param {number} clientX
         * @param {number} clientY
         * @returns {{x: number, y: number}}
         */
        function getSvgCoords(clientX, clientY) {
            const CTM = svg.getScreenCTM();
            // ä½¿ç”¨ CTM çŸ©é™£å°‡è¢å¹•åº§æ¨™è½‰æ›ç‚º SVG ç©ºé–“åº§æ¨™
            return {
                x: (clientX - CTM.e) / CTM.a,
                y: (clientY - CTM.f) / CTM.d
            };
        }

        // ------------------ é›»è·¯é‚è¼¯ ------------------

        /**
         * æª¢æŸ¥æ‰€æœ‰æ¢ä»¶æ˜¯å¦æ»¿è¶³é›»è·¯é–‰åˆ
         */
        function checkCircuitClosure() {
            // é–‰åˆæ¢ä»¶ï¼šé–‹é—œé–‰åˆ AND (æœ‰å°é›»é«”åœ¨ç¼ºå£ä¸­)
            return isSwitchClosed && itemInGap === 'conductor';
        }

        /**
         * è™•ç†é–‹é—œé»æ“Šäº‹ä»¶
         */
        function toggleSwitch() {
            isSwitchClosed = !isSwitchClosed;
            updateCircuitUI();
        }

        /**
         * æ ¹æ“šé›»è·¯ç‹€æ…‹æ›´æ–°æ‰€æœ‰è¦–è¦ºå…ƒä»¶
         */
        function updateCircuitUI() {
            const isCircuitClosed = checkCircuitClosure();

            // 1. é–‹é—œè¦–è¦º
            if (isSwitchClosed) {
                switchArmOpen.classList.add('hidden');
                switchArmClosed.classList.remove('hidden');
            } else {
                switchArmOpen.classList.remove('hidden');
                switchArmClosed.classList.add('hidden');
            }

            // 2. ç‡ˆæ³¡ã€é›»æµå’Œç‹€æ…‹è¨Šæ¯
            if (isCircuitClosed) {
                // ON ç‹€æ…‹
                lightBulb.classList.remove('bulb-off-cartoon');
                lightBulb.classList.add('bulb-on-cartoon');

                currentPath1.classList.remove('hidden');
                currentPath2.classList.remove('hidden');
                testGapConnector.classList.remove('hidden');

                currentPath1.classList.add('electric-flow');
                currentPath2.classList.add('electric-flow');

                statusMessage.textContent = 'é›»è·¯ç‹€æ…‹ï¼šé–‰åˆï¼ç‡ˆæ³¡äº®èµ·ä¾†å•¦ï¼âœ¨';
                statusMessage.classList.remove('text-red-600', 'animate-pulse');
                statusMessage.classList.add('text-green-600', 'animate-bounce-slow');

            } else {
                // OFF ç‹€æ…‹
                lightBulb.classList.remove('bulb-on-cartoon');
                lightBulb.classList.add('bulb-off-cartoon');

                currentPath1.classList.add('hidden');
                currentPath2.classList.add('hidden');
                testGapConnector.classList.add('hidden');

                currentPath1.classList.remove('electric-flow');
                currentPath2.classList.remove('electric-flow');

                let statusText = 'é›»è·¯ç‹€æ…‹ï¼šæ–·é–‹ (ç‡ˆæ³¡æš—æš—çš„...)';
                if (isSwitchClosed && itemInGap === 'insulator') {
                    statusText = 'é›»è·¯ç‹€æ…‹ï¼šæ–·é–‹ï¼çµ•ç·£é«”ç„¡æ³•å°é›»ï¼âŒ';
                } else if (isSwitchClosed && itemInGap === null) {
                    statusText = 'é›»è·¯ç‹€æ…‹ï¼šæ–·é–‹ï¼ç¼ºå£éœ€è¦è¢«å¡«è£œï¼';
                } else if (!isSwitchClosed) {
                    statusText = 'é›»è·¯ç‹€æ…‹ï¼šæ–·é–‹ (è«‹å…ˆæ‹–æ›³å…ƒä»¶ä¸¦é–‰åˆé–‹é—œ)';
                }

                statusMessage.textContent = statusText;
                statusMessage.classList.add('text-red-600', 'animate-pulse');
                statusMessage.classList.remove('text-green-600', 'animate-bounce-slow');
            }
        }
        
        // ------------------ æ‹–æ›³é‚è¼¯ (Drag and Drop) ------------------

        /**
         * è™•ç†æ‹–æ›³é–‹å§‹ (æ»‘é¼ /è§¸æ§)
         */
        function handleDragStart(e) {
            // é˜»æ­¢é è¨­è¡Œç‚ºï¼šåªå°è§¸æ§äº‹ä»¶é˜»æ­¢ï¼Œé˜²æ­¢é é¢æ»¾å‹•ã€‚æ»‘é¼ äº‹ä»¶çš„é˜»æ­¢ç•™çµ¦ handleDragMove è™•ç†ï¼Œä»¥ç¢ºä¿æ‹–æ›³å•Ÿå‹•é †æš¢
            if (e.type === 'touchstart') {
                e.preventDefault(); 
            }
            
            // æ‰¾åˆ°è¢«é»æ“Šçš„ draggable-item G å…ƒç´ 
            const targetElement = e.target.closest('.draggable-item');
            
            if (targetElement) {
                activeDragElement = targetElement;
                isDragging = true;
                activeDragElement.classList.add('dragging');
                
                // å°‡æ‹–æ›³ä¸­çš„å…ƒç´ ç§»åˆ°æœ€ä¸Šå±¤
                svg.appendChild(activeDragElement);

                // ç²å–ç•¶å‰ transform
                const transform = activeDragElement.transform.baseVal.getItem(0);
                const currentX = transform.matrix.e;
                const currentY = transform.matrix.f;
                
                // è¨ˆç®—åç§»é‡
                const { clientX, clientY } = getEventClientCoords(e);
                const { x: mouseX, y: mouseY } = getSvgCoords(clientX, clientY);
                
                offset = {
                    x: mouseX - currentX,
                    y: mouseY - currentY
                };

                // æ¸…é™¤ä¹‹å‰çš„ itemInGap ç‹€æ…‹ (å¦‚æœé€™å€‹å…ƒç´ åŸæœ¬åœ¨ Gap å…§)
                const elementType = activeDragElement.getAttribute('data-type');
                if (itemInGap === elementType) {
                    itemInGap = null;
                }
                
                updateCircuitUI();
            }
        }

        /**
         * è™•ç†æ‹–æ›³ç§»å‹• (æ»‘é¼ /è§¸æ§)
         */
        function handleDragMove(e) {
            if (!isDragging || !activeDragElement) return;

            e.preventDefault(); // é˜»æ­¢æ»‘é¼ é¸å–æ–‡å­—æˆ–è§¸æ§æ»¾å‹•
            const { clientX, clientY } = getEventClientCoords(e);
            const { x: mouseX, y: mouseY } = getSvgCoords(clientX, clientY);

            // æ›´æ–°å…ƒç´ ä½ç½®
            const newX = mouseX - offset.x;
            const newY = mouseY - offset.y;

            // æ‡‰ç”¨æ–°çš„ transform
            activeDragElement.setAttribute('transform', `translate(${newX}, ${newY})`);
        }

        /**
         * è™•ç†æ‹–æ›³çµæŸ (æ»‘é¼ /è§¸æ§)
         */
        function handleDragEnd(e) {
            if (!isDragging || !activeDragElement) return;

            isDragging = false;
            activeDragElement.classList.remove('dragging');

            const transform = activeDragElement.transform.baseVal.getItem(0);
            const currentX = transform.matrix.e;
            const currentY = transform.matrix.f;
            
            // å®šç¾©å…ƒä»¶çš„åˆå§‹ä½ç½®
            const originalPosition = activeDragElement.id === 'conductor-item' ? 
                                     { x: 50, y: 400 } : 
                                     { x: 200, y: 400 };

            // å…ƒä»¶çš„ä¸­å¿ƒé» (å¯¬åº¦ 100, é«˜åº¦ 40)
            const itemCenterX = currentX + 50;
            const itemCenterY = currentY + 20;

            // æª¢æŸ¥å…ƒä»¶ä¸­å¿ƒé»æ˜¯å¦åœ¨æ¸¬è©¦å€çš„å®¹è¨±ç¯„åœå…§
            const isNearGap = (
                itemCenterX > (gapTarget.x - gapTolerance) &&
                itemCenterX < (gapTarget.x + gapTolerance) &&
                itemCenterY > (gapTarget.y - gapTolerance) &&
                itemCenterY < (gapTarget.y + gapTolerance)
            );
            
            if (isNearGap) {
                // å°é½Šåˆ°æ¸¬è©¦å€ä¸­å¿ƒ (450, 330 æ˜¯å…ƒä»¶å·¦ä¸Šè§’åº§æ¨™ï¼Œä½¿å…¶ä¸­å¿ƒ (500, 350) å°é½Š Gap Target)
                const targetX = gapTarget.x - 50; 
                const targetY = gapTarget.y - 20; 
                activeDragElement.setAttribute('transform', `translate(${targetX}, ${targetY})`);

                // æ›´æ–° itemInGap ç‹€æ…‹
                itemInGap = activeDragElement.getAttribute('data-type');
            } else {
                // æ¢å¾©åˆå§‹ä½ç½®
                activeDragElement.setAttribute('transform', `translate(${originalPosition.x}, ${originalPosition.y})`);
                itemInGap = null; 
            }
            
            activeDragElement = null; // æ¸…é™¤æ‹–æ›³ä¸­çš„å…ƒç´ 
            updateCircuitUI();
        }


        function init() {
            // ç¶å®šé–‹é—œé»æ“Šäº‹ä»¶
            switchArmOpen.addEventListener('click', toggleSwitch);
            switchArmClosed.addEventListener('click', toggleSwitch);

            // ç¢ºä¿æ‰€æœ‰å¯æ‹–æ›³å…ƒç´ éƒ½æœ‰åˆå§‹ transform å±¬æ€§ï¼Œæ–¹ä¾¿ JS æ“ä½œ
            conductorItem.transform.baseVal.initialize(svg.createSVGTransformFromMatrix(svg.createSVGMatrix()));
            insulatorItem.transform.baseVal.initialize(svg.createSVGTransformFromMatrix(svg.createSVGMatrix()));

            // ç¶å®šæ‹–æ›³äº‹ä»¶ (æ»‘é¼ )
            svg.addEventListener('mousedown', handleDragStart);
            document.addEventListener('mousemove', handleDragMove);
            document.addEventListener('mouseup', handleDragEnd);
            
            // ç¶å®šæ‹–æ›³äº‹ä»¶ (è§¸æ§)
            svg.addEventListener('touchstart', handleDragStart);
            // { passive: false } é˜»æ­¢ç€è¦½å™¨é è¨­æ»¾å‹•è¡Œç‚ºï¼Œå¯¦ç¾æ‹–æ›³
            document.addEventListener('touchmove', handleDragMove, { passive: false }); 
            document.addEventListener('touchend', handleDragEnd);

            updateCircuitUI();
        }

        window.onload = init;
    </script>
</body>
</html>
